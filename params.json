{"name":"Coreos","tagline":"How to setup a CoreOS cluster along with some useful bells and whistles","body":"### Summary\r\n* Setup 3 node CoreOS cluster via Cloud Formation fronted by an ELB\r\n* Deploy monitoring and logging containers\r\n* Deploy http server container\r\n* Setup .bit domain\r\n* Add automated build, test and deploy\r\n\r\n### Setup Docker\r\nAssuming you are on OSX here.\r\n1. [Install](https://www.virtualbox.org/) virtualbox, it's needed by boot2docker.\r\n2. [Install](https://www.vagrantup.com/downloads) vagrant.  While not strictly necessary it comes in handy if you want to create local clusters on your workstation.\r\n3. [Install](https://docs.docker.com/installation/mac/) docker, or rather boot2docker, if you're on OSX.\r\n4. [Create an account](https://hub.docker.com/) on dockerhub.\r\n\r\n\r\n### Setup AWS\r\n[Create an account](https://aws.amazon.com/) with Amazon AWS.  You will have to pay for your usage.  A single CoreOS cluster with an ELB is costing me about $3 a day.\r\nAdd an account via [IAM](https://aws.amazon.com/iam/).\r\nGenerate an SSH keypair locally and upload the public key, or upload your existing public key:\r\n```\r\nssh-keygen -t rsa -f id_rsa\r\n```\r\n\r\n[Install](http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-set-up.html) the AWS command line tools.\r\n```\r\nwget https://s3.amazonaws.com/aws-cli/awscli-bundle.zip\r\nunzip awscli-bundle.zip\r\nsudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws\r\n```\r\n\r\nAdd necessary environment variables to your ~/.bash_profile:\r\n```\r\n# AWS creds\r\nexport AWS_ACCESS_KEY_ID=XXXXXXXXXXXXXX\r\nexport AWS_SECRET_ACCESS_KEY=XXXXXXXXXXXXXXXXXXXXXX\r\nexport AWS_DEFAULT_REGION=us-west-1\r\nexport AWS_DEFAULT_OUTPUT=text\r\n```\r\n\r\n### Launch Cloud Formation Stack\r\nUsing the template provided from CoreOS, add your own parameters and fire up [Cloud Formation](http://docs.aws.amazon.com/cli/latest/reference/cloudformation/create-stack.html).\r\n\r\nDonâ€™t forget to generate a new DiscoveryURL at https://discovery.etcd.io/new\r\nThe following parameters are passed to the template, if you want to change them:\r\n* DiscoveryURL\r\n* InstanceType\r\n* KeyPair\r\n\r\nThe template sets the following defaults.  If you want something else, [other templates](https://coreos.com/docs/running-coreos/cloud-providers/ec2/) are available from CoreOS.\r\n* CoreOS channel: alpha\r\n* PV vs HVM: HVM\r\n* Region: us-west-1\r\n\r\n```\r\naws cloudformation create-stack --stack-name CoreOS-alpha --template-url https://s3.amazonaws.com/coreos.com/dist/aws/coreos-alpha-hvm.template --parameters ParameterKey=DiscoveryURL,ParameterValue=https://discovery.etcd.io/0ffffffffffffffffffffffffffff,UsePreviousValue=true ParameterKey=InstanceType,ParameterValue=t2.small,UsePreviousValue=true ParameterKey=KeyPair,ParameterValue=daniel,UsePreviousValue=true\r\n```\r\n\r\nWatch the magic happen in your AWS web console.  Once created, adjust ASG Max instances to 3 (to prevent ballooning resource use).","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}